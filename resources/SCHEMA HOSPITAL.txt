CREATE TABLE PSV ( --PRESTADOR DE SERVICO
	PSV_COD INT NOT NULL,
	PSV_NOME VARCHAR(50) NOT NULL,
	PSV_CPF BIGINT NOT NULL,
	PSV_CONSELHO VARCHAR(50),
	PSV_TIPO VARCHAR(10) NOT NULL,
	PSV_UF VARCHAR(3) NOT NULL,

	PRIMARY KEY (PSV_COD),
	CHECK (PSV_CPF >= 1000000000),
	CHECK (PSV_CPF < 100000000000)
);

INSERT INTO PSV
VALUES (1,'TACINHO FOFINHO', 12345678901, 'CRM', 'MEDICO', 'BA');

CREATE TABLE CNV ( --CONVENIO
	CNV_COD SERIAL,
	CNV_NOME VARCHAR(10) NOT NULL,

	PRIMARY KEY (CNV_COD)
);

INSERT INTO CNV (CNV_NOME)
VALUES ('PARTICULAR');

CREATE TABLE PAC ( -- PACIENTE
	PAC_REG SERIAL,
	PAC_DTHR_REG DATE NOT NULL,
	PAC_NOME VARCHAR(50) NOT NULL,
	PAC_BIRTH DATE NOT NULL,
	PAC_CPF BIGINT,
	PAC_CNV_COD INT NOT NULL,
	PAC_TEL BIGINT,

	PRIMARY KEY(PAC_REG),
	FOREIGN KEY (PAC_CNV_COD) REFERENCES CNV(CNV_COD)
);

INSERT INTO PAC (PAC_DTHR_REG,PAC_NOME,PAC_BIRTH,PAC_CPF,PAC_CNV_COD,PAC_TEL)
VALUES (CURRENT_TIMESTAMP,'TACINHO FOFINHO DOENTINHO', '10-09-2001', 12345678901, 1, 77988333180);

CREATE TABLE STR ( --SETOR
	STR_COD SERIAL,
	STR_NOME VARCHAR(10) NOT NULL,
	STR_RESP VARCHAR(10), -- REFERENCIA USR_LOGIN

	PRIMARY KEY (STR_COD)
);

INSERT INTO STR (STR_NOME,STR_RESP)
VALUES ('ADM', 'ADMIN');

CREATE TABLE USR ( --USUARIO
	USR_LOGIN VARCHAR(10) NOT NULL,
	USR_SENHA VARCHAR(15) NOT NULL,
	USR_NOME VARCHAR(50) NOT NULL,
	USR_STR_COD INT NOT NULL,
	USR_BIRTH DATE NOT NULL,
	USR_CPF BIGINT NOT NULL,

	PRIMARY KEY (USR_LOGIN),
	FOREIGN KEY (USR_STR_COD) REFERENCES STR(STR_COD),
	CHECK (USR_CPF >= 1000000000),
	CHECK (USR_CPF < 100000000000)
);

INSERT INTO USR
VALUES ('ADMIN', 'SQLADOS', 'ADMINISTRADOR', 1, '10-09-2001', 12345678901);

CREATE TABLE EQP ( -- EQUIPAMENTO
	EQP_NUMERO SERIAL,
	EQP_DTHR_REGISTRO DATE NOT NULL,
	EQP_NOME VARCHAR(20) NOT NULL,
	EQP_STR_COD INT NOT NULL,

	PRIMARY KEY (EQP_NUMERO),
	FOREIGN KEY (EQP_STR_COD) REFERENCES STR(STR_COD)
);

INSERT INTO EQP (EQP_DTHR_REGISTRO,EQP_NOME,EQP_STR_COD)
VALUES (current_timestamp, 'CAMISA DA SELECAO', 1);

CREATE TABLE OS ( -- ORDEM DE SERVICO
	OS_NUMERO SERIAL,
	OS_PAC_REG INT NOT NULL,
	OS_DTHR DATE NOT NULL,
	OS_REQUISITANTE INT NOT NULL, --REFERENCIA PSV_COD
	OS_STR_COD INT NOT NULL,
	OS_TIPO_ATEND VARCHAR(15) NOT NULL,
	OS_USR_RESP VARCHAR(10) NOT NULL, -- REFERENCIA USR_LOGIN
	OS_CNV_COD INT NOT NULL,

	PRIMARY KEY (OS_NUMERO),
	FOREIGN KEY (OS_PAC_REG) REFERENCES PAC(PAC_REG),
	FOREIGN KEY (OS_REQUISITANTE) REFERENCES PSV(PSV_COD),
	FOREIGN KEY (OS_STR_COD) REFERENCES STR(STR_COD),
	FOREIGN KEY (OS_USR_RESP) REFERENCES USR(USR_LOGIN),
	FOREIGN KEY (OS_CNV_COD) REFERENCES CNV(CNV_COD)
);

ALTER TABLE STR
ADD FOREIGN KEY (STR_RESP) REFERENCES USR(USR_LOGIN);